# 変更履歴 (CHANGELOG)

このファイルはプロジェクトの全ての重要な変更を記録します。

**重要：更新があったときは必ずチェンジログを更新すること**

フォーマットは [Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) に基づいています。

---

## [1.3.9] - 2026-02-10

### 修正
- **バックグラウンド再生OFF時も再生されてしまう問題を修正**
  - アプリがバックグラウンドに移った際、設定がOFFならメトロノーム・プログラムメトロノーム・コード再生を自動停止
  - AppState の `background` イベントで `stop()` / `setIsPlaying(false)` を実行
- **拍分割（特に16分音符）のテンポが不確実になる問題を改善**
  - `setTimeout` によるスケジュールをやめ、Web Audio API の `ctx.currentTime` による精密スケジュールに変更
  - オーディオスレッドで実行されるため、JSスレッドの負荷やモバイルのスロットリングの影響を軽減

### 改善
- **ヘッダ・フッタを画面端まで伸ばし、コンテンツ（ボタン等）は余白内に配置**
  - タブバー: 背景は画面端まで、タブボタンは safe area 内
  - メトロノーム: コントロールバー（拍子・拍分割等）の背景は画面端まで
  - ハーモニー: HarmonyControls の背景は画面端まで
  - コード再生: ヘッダーの背景は画面端まで

### 修正
- **iPhone ノッチ対策の余白を横画面の左右のみに修正**
  - ノッチは横画面時に左右に来るため、余白は左右のみに適用（top/bottom は insets をそのまま使用）
  - Apple ガイドライン 44pt〜59pt を左右の余白に採用
- **最初に開いたタブで音が鳴らないバグを修正（iOS/Android共通）**
  - 原因: タブ切り替え時に前のタブがアンマウントされ、`useAudioEngine` のクリーンアップで `refCount` が 0 になり AudioContext が閉じられていた。次のタブで再作成に数百msかかり、最初のタブでは初期化完了前にタップされると音が出なかった
  - 修正: `home.tsx` で `useAudioEngine` を常時マウントし、タブ切り替えでも AudioContext を破棄しないように変更
  - 併せて `resumeAudioContextSync` を追加（iOS: ユーザージェスチャー内で同期的に `ctx.resume()` を呼ぶ必要があるため）
  - 音関係でバグったときに参照: この状態（HomeScreen で useAudioEngine 保持、タブ切り替えで refCount が 0 にならない）を維持すること

### 改善
- **コード再生のデフォルトプリセットを「基本的な I-IV-V（C, F, G）」に変更**
- **メトロノームの PRG ボタンのスタイルを拍子・拍分割に統一**

---

## [1.3.8] - 2026-01-31

### 修正
- **iOSでのクラッシュを根本的に修正（複数AudioContext問題の解決）**
  - `useAudioEngine.ts`をシングルトンパターンに変更し、複数のコンポーネントが`useAudioEngine()`を呼んでもAudioContextは1つだけになるように修正
  - モジュールレベルの共有変数（`_sharedCtx`、`_sharedMasterGain`）を使用し、参照カウンターで最後のインスタンスがアンマウントされた時のみクリーンアップ
  - これにより、最大8つのAudioContextが同時に存在していた問題を解決（各AudioContextが独立したネイティブスレッドプールを作成していたため、iOSでスレッド競合が発生していた）

### 改善
- **不要なAudioContext作成を削除**
  - `PresetManager`と`PresetSelector`から`useAudioEngine()`の呼び出しを完全削除（プリセット管理にオーディオ操作は不要）
  - `VoicingEditorModal`をprops経由に変更し、親コンポーネントから`startNote`/`stopAllNotes`を渡すように修正
  - これにより、モーダル開閉時に不要なAudioContextが作成されることを防止

- **AudioContextの再作成ロジックを削除**
  - `ensureAudioContextReady`からAudioContext再作成ロジックを削除（閉じたAudioContextを再作成するとスレッド競合が発生するため）
  - AudioContextが閉じられている場合は単に`false`を返すように変更

- **コードの簡素化**
  - `playback.tsx`から不要な`stopAllNotes()`呼び出しと`setTimeout()`遅延を全て削除
  - モーダル開閉時の過剰な安全策を削除し、シンプルな実装に変更
  - コード選択、プリセット読み込み、ボイシング編集などの処理を簡素化

### 技術的詳細
- **クラッシュの原因**: 複数の`AudioContext`インスタンスが同時に存在し、それぞれが独立したネイティブスレッドプール（`audioapi::ThreadPool`、`audioapi::AudioNodeDestructor`）を作成していたため、iOSでスレッド競合が発生し`SIGABRT`クラッシュが発生していた
- **修正方法**: `useAudioEngine`フックをシングルトンパターンに変更し、すべてのコンポーネントが同一のAudioContextを共有するように修正
- **影響範囲**: メトロノーム、ハーモニー、コード再生、プリセット管理の全画面でクラッシュが解消される

---

## [1.3.7] - 2026-01-31

### 変更
- **ボイシング編集機能をSATB（4声）方式に変更**
  - 西洋和声の基本である4声体（Bass, Tenor, Alto, Soprano）に対応
  - 各声部にピッチクラス（C, C#, D...）とオクターブを個別に割り当て可能
  - コードの構成音のみを選択可能に制限（コード外の音は選択不可）
  - ボイシング変更時の表示を🎹絵文字から小さなドット（●）に変更

### 改善
- **テンプレート読み込み時の動作を改善**
  - テンプレートを再度選択した際、常に元の保存状態にリセットされるように変更
  - 「現状を保存」を押さない限り、編集内容は保存されない仕様に変更
  - ユーザーが編集した場合は、テンプレート状態が自動的に解除される

### 修正
- **声部連結の動作を修正**
  - テンプレート読み込み時でも、最初の小節以降は声部連結が正しく適用されるように修正
  - 「近い音に移る」「ベースラインはルート音になる」というルールが正しく動作するように改善

### iOS対応
- **iPhone SE第3世代などの小さい画面サイズに対応**
  - メトロノーム画面：プリセットボタンと再生ボタンが画面サイズに応じて調整されるように修正
  - ハーモニー画面：コードタイルの上下の重なりを解消
  - すべての画面で`flexWrap`と`flexShrink`を使用してレスポンシブ対応を強化

### バグ修正
- **iOSでのクラッシュを修正**
  - プログラムモード：新規作成時のクラッシュを修正（エラーハンドリングを強化）
  - コード再生画面：コード選択時のクラッシュを修正（モーダル閉じる際の遅延追加）
  - `react-native-audio-api`のエラーハンドリングを追加（Expo Goでもクラッシュしないように）

---

## [1.3.6] - 2026-01-31

### 追加
- **コード再生画面にユーザー向けボイシング編集機能を追加**
  - 小節のコード名を長押しすることで、ボイシング編集モーダルを開けるように改善
  - 各構成音のオクターブを個別に調整可能（2〜7オクターブ）
  - プレビュー機能で編集内容を確認してから保存可能
  - カスタムボイシングはプリセット保存時に保存され、次回読み込み時に復元

### 改善
- **コード選択モーダルの表示を大幅に改善**
  - モーダルの高さを画面の90%に拡大し、一度に見えるコード数を増加
  - モーダルを上寄せ表示に変更し、スクロール領域を最大化
  - スクロールが最後まで表示されるように下部の余白を調整
  - 画面サイズに基づいて動的に高さを設定

### UI改善
- **ボイシング編集機能の使い方を明示**
  - BPM表示の下に「長押しでボイシング編集」の説明を追加
  - カスタムボイシングが設定された小節には🎹アイコンを表示

---
## [1.3.5] - 2026-01-31

### 追加
- **コード再生画面にテンプレート専用の構成音指定機能を追加**
  - テンプレート読み込み時のみ、`measures[].midiNotes` をそのまま使用（声部連結なし）
  - ユーザーがコードを手動選択した場合は従来通り声部連結を適用
  - テンプレート作成時に `createMeasure` の第3引数で構成音を指定可能
  - 例：`createMeasure('id', 'C', [60, 64, 67])` で C のボイシングを指定

### 改善
- **コード再生画面の再生中に現在の小節が自動スクロールされるように改善**
  - 再生中に小節が切り替わると、その小節が画面中央に表示されるように自動スクロール
  - 長いコード進行でも再生中の小節を常に確認可能

---

## [1.3.4] - 2026-01-31

### 修正
- **ハーモニータブの鍵盤タッチ処理をオリジナル実装に復元**
  - 1.3.2 および 1.3.3 の修正で発生した問題（タッチ位置のずれ悪化）を解消
  - 安定動作していたオリジナルの `pageX`/`pageY` + `measureInWindow` 方式に戻す
  - Google Pixel でのタッチずれは別途調査予定（端末固有の問題の可能性）

---

## [1.3.3] - 2026-01-31

### 修正
- **ハーモニータブの鍵盤タッチ位置の精度を大幅に改善（試験的）**
  - タッチイベントの `locationX`/`locationY`（要素相対座標）を優先使用するよう変更
  - ※ この修正は問題があり、1.3.4 でリバートされました

---

## [1.3.2] - 2026-01-31

### 修正
- **ハーモニータブの鍵盤タッチ位置のずれを修正（試験的）**
  - Android で PixelRatio による座標補正を追加
  - ※ この修正は問題があり、1.3.4 でリバートされました

---

## [1.3.1] - 2026-01-30

### 追加
- **コード再生画面にトランスポーズ機能を追加**
  - ヘッダーに「トランスポーズ」の − / + ボタンを追加
  - 表示中のコード名を半音単位でトランスポーズ（−11 〜 +11 半音）
  - トランスポーズしたコード名で表示が置き換わり、再生もトランスポーズ後のキーで鳴る
  - 再生中はトランスポーズの変更を無効化

---

## [1.3.0] - 2026-01-30

### 追加
- **コード再生機能を追加**
  - 新しいタブ「コード再生」を追加
  - 入力したコードをテンポに沿って再生する機能の大枠を実装
  - メトロノームのテンポと拍子に同期してコードを再生
  - カウントイン機能を追加（再生開始時に1小節分のカウントイン）
  - カウントイン中は「カウントイン」と現在の拍数を大きく表示
  - メトロノームのオン/オフ機能を追加（設定パネルから切り替え可能）
  - 小節を表形式（グリッド）で表示し、現在再生中の小節を視覚的に強調
  - コード選択画面をテーブル形式に変更（12音の基本コードが横に並び、派生コードが下に連なる）
  - 設定パネルをアコーディオン形式で折りたたみ可能に（スムーズなアニメーション付き）
  - テンポ入力フィールドを追加（数値直接入力可能）
  - **コード再生画面にプリセット機能を追加**
    - ヘッダーに「保存」と「読み込み」ボタンを追加
    - 現在のコード進行、テンポ、拍子、メトロノーム設定をプリセットとして保存可能
    - 保存したプリセットを読み込んで設定を復元可能
    - プリセット管理モーダルで保存済みプリセットの一覧表示・削除が可能
    - 再生中はプリセット操作を無効化

### 変更
- **ハーモニーの音色名を変更**
  - 「オルガン2」→「ピアノ」に表示名を変更（文字長を短縮）
  - グランドピアノの音色を改善（より自然な減衰、倍音バランスの調整）
- **コード再生画面のUI改善**
  - 再生ボタンの色をわかりやすく変更（再生時：緑、停止時：赤）
  - 再生ボタンに影とエレベーションを追加して視認性を向上
  - コード選択モーダルを大きくし、コードが溢れないように改善
  - コード選択画面のレイアウトを改善（12音×派生コードのテーブル形式）
  - コード選択モーダルの縦幅を拡大（minHeight: 550px、maxHeight: 85%）
  - プリセット管理モーダルのスクロール機能を改善（ScrollViewの設定を最適化）
  - プリセット管理モーダルのサイズを調整（maxHeight: 85%、minHeight: 300px）
  - **設定パネルをモーダル形式に変更**
    - アコーディオン形式の設定パネルを削除
    - 右上に設定ボタン（⚙️）を追加
    - 設定ボタンをタップすると右上からモーダルが表示される形式に変更
    - 他のタブと統一感のあるUIに改善
  - **グローバルタイムラインの見切れを修正**
    - タイムラインの高さを4pxから6pxに拡大
    - overflowを'visible'に変更して見切れを防止
    - z-indexを調整して設定モーダルとの重なりを解消
  - **カウントインの修正**
    - 拍子に応じた正しい拍数のカウントインを実装（4/4拍子なら4拍、3/4拍子なら3拍）
    - カウントイン終了条件を修正（`countInBeat > timeSignature.numerator`）
  - **ボタンサイズの調整**
    - プリセット保存・読み込みボタンのサイズを拡大（メトロノームタブと統一）
    - 設定ボタンのサイズを調整し、ボーダーを追加
    - 設定ボタンのアイコンを絵文字からUnicode記号（⚙）に変更
  - **コードライブラリの修正**
    - 9thコード（9）とマイナー9thコード（m9）の構成音を修正（セブンスを含む正しい構成音に変更）
    - Diminish7（dim7）コードを追加
    - 小節セル全体をタップ可能に変更（コード選択モーダルが開く）
    - コード選択モーダルの表示速度を改善（ハードウェアアクセラレーション有効化、メモ化）
- **メトロノームとコードのタイミング同期**
  - メトロノームのクリック音とコードの切り替えを1つのインターバルに統合
  - 小節の最初の拍でコードを切り替え、メトロノームのアクセントと同期

---

## [1.2.0] - 2026-01-29

### 削除
- **スプラッシュスクリーンとアダプティブアイコンの表示を無効化**
  - `app.json`から`splash`設定を削除
  - `app/_layout.tsx`で`SplashScreen.hideAsync()`を呼び出してスプラッシュスクリーンを即座に非表示
  - アプリ起動時にスプラッシュアイコンが表示されないように変更

### 修正
- **黒鍵のタッチ位置を改善**
  - 黒鍵の高さ全体でタッチできるように条件を緩和（`relativeY < blackKeyHeight * 1.2`）
  - 黒鍵の左右のタッチ範囲を拡大（余裕を-2〜+2から-5〜+5に変更）
  - 黒鍵の範囲全体でタッチ可能に改善
- **音が持続するバグを完全修正**
  - `handleTouchMove`で新しい鍵に移動したとき、`lastNoteRef.current`も含めてすべての音を確実に停止
  - `handleTouchEnd`で`lastNoteRef.current`も含めてすべての音を確実に停止
  - `handleTouchMove`で`midi === null`のとき（鍵盤の外に出たとき）も確実に音を停止
  - ホールドモードでも鍵盤の外に出た場合は前の音を停止するように改善
  - `onPanResponderRelease`と`onPanResponderTerminate`で`handleTouchEnd`を呼び出すように統一

---

## [1.1.0] - 2026-01-29

### 削除
- **チューナー機能を完全削除**
  - `app/tuner.tsx`、`hooks/useTuner.ts`を削除
  - タブバーからチューナータブを削除
  - マイク権限の説明文を汎用的なものに変更

### 修正（根本的な解決）
- **黒鍵のタッチ位置ずれを修正**
  - レンダリング位置 `(key.position + 1) * whiteKeyWidth` とタッチ検出位置を一致させる
  - 黒鍵を正確な位置でタッチできるように修正
- **音が途中で鳴らなくなる問題を根本解決**
  - `ensureAudioContextReady()`関数を追加し、AudioContextとマスターGainNodeの状態を確認・修復
  - AudioContextがclosedまたはsuspendedの場合は自動的に再作成・再開
  - マスターGainNodeが存在しない場合は自動的に再作成
  - オルガン2の倍音とノイズが`ctx.destination`に直接接続されていた問題を修正し、すべて`masterGain`経由に統一
  - エラーハンドリングを強化し、エラーが発生しても他の音に影響を与えないように改善
  - オルガン2の倍音生成でエラーが発生した場合も処理を続行できるようにtry-catchを追加
  - デバッグログを追加して問題の特定を容易に

---

## [1.0.18] - 2026-01-29

### 修正（根本的な解決）
- **音量振り切れ後の音が出なくなる問題を根本解決**
  - マスターGainNodeを追加し、全体の音量を70%に制限（クリッピング防止）
  - 同時に鳴らせる音の最大数を32に制限し、上限に達したら古い音を自動停止
  - オシレーターのカウント管理を追加（activeNoteCountRef）でリソース保護
  - すべての音をマスターGainNode経由で出力するように変更
- **鍵盤スライド時の音保持バグを完全修正**
  - `handleTouchMove`で鍵盤の外に出たとき（midi === null）も前の音を確実に停止
  - `onPanResponderRelease`でリリース時にすべての音を確実に停止する処理を追加
  - ホールドモードと通常モードで処理を分離し、通常モードでは常に前の音を停止
- **チューナーのマイク入力問題を根本解決**
  - **AnalyserNodeの出力をdestinationに接続**（重要：これがないとデータが流れない）
  - AudioRecorderのstart()に明示的な設定（sampleRate, numberOfChannels, bitDepth）を追加
  - 音量レベルの計算を改善し、データが動いているかどうかを確認（dataRangeチェック）
  - 音量インジケーターの感度を上げる（rms * 500）
  - デバッグログを追加して録音開始の成功/失敗を確認可能に
  - stop()でAnalyserNodeの接続を確実に切断

---

## [1.0.17] - 2026-01-29

### 追加
- **アプリアイコン仕様のドキュメント（docs/APP_ICON.md）**
  - Android アダプティブアイコンで「はみ出し」が出る場合の原因と対処を記載
  - 推奨サイズ 1024×1024、セーフゾーン中央 66% の説明
  - 前景用に余白付きの `adaptive-icon.png` を用意する手順

### 修正
- **オルガン2の音色を修正**
  - 残響・ラグの原因だった長い減衰（2.5秒）を約0.45秒に短縮
  - 倍音を短い減衰（0.06〜0.15秒）で同期して消すように変更し、周波数帯がバラバラに消える現象を解消
  - サステインを廃止し、アタック＋指数減衰のみのシンプルなエンベロープに
- **鍵盤スライド時の音持続バグを修正**
  - 隣の鍵に移動したときに、前の鍵（lastNoteRef）を明示的に onNoteOff するように変更
  - スライド時に前の音が残る事象を防止
- **チューナーに音量インジケーターを追加**
  - 入力音量（0〜100）をバーと数値で表示し、マイクが正しく入力しているか確認可能に
  - オートコリレーションのRMS閾値を下げて検出しやすく調整
  - Analyser の smoothingTimeConstant を 0.7 → 0.3 に変更し、針の反応を速く

---

## [1.0.16] - 2026-01-29

### 修正
- **鍵盤タッチバグを根本修正**
  - PanResponderの実装を簡素化し、依存配列を正しく設定
  - コンポーネントマウント時に複数回（100ms, 300ms, 500ms）レイアウト測定を試行
  - 不要なlayoutRef/getMidiFromPositionWithLayoutを削除し、シンプルな実装に戻す
- **チューナーをオートコリレーション法で再実装**
  - 既存のFFT/ゼロクロッシング法からオートコリレーション法に変更
  - オートコリレーションは多くのプロ向けチューナーアプリで採用されている信頼性の高い手法
  - RMS（音量レベル）チェックで適切な感度調整
  - 放物線補間でピーク位置を精密化し、より正確な周波数検出を実現
- **メトロノームのバックグラウンド再生を強化**
  - 再生中は1秒ごとにAudioContextの状態をチェックしてresumeする仕組みを追加
  - AppStateを監視し、フォアグラウンド復帰時にAudioContextを再開
  - expo-avのオーディオモードを再生開始時に明示的に設定
  - `ensureAudioContextResumed`と`keepAudioAliveForBackground`をuseAudioEngineに追加

---

## [1.0.15] - 2026-01-29

### 修正
- **チューナー自動スタート**
  - 画面に入ったら自動的にチューナーが開始するように変更
  - 開始/停止ボタンを削除（画面を離れると自動停止）
  - 「開始ボタンを押して測定を開始」というメッセージを削除
- **鍵盤のタッチバグ修正**
  - layout未測定時でもタッチを受け付けるように改善
  - `layoutRef`を追加してPanResponder内で即座に参照できるように
  - `getMidiFromPositionWithLayout`を追加してlayout引数を受け取れるように
- **音が途中で出なくなるバグ修正**
  - `startNote`でAudioContextがsuspendedの場合に`resume()`を呼び出すように追加
  - Androidでバックグラウンドから復帰時の音声再生を改善
- **コードモードでピッチ/調律をリアルタイム反映**
  - `ChordProgressionPad`に`useEffect`を追加
  - `basePitch`/`tuning`が変更されたときに鳴っているコードを自動的に再生し直す
  - コード演奏中に平均律/純正律の切り替えやピッチ変更が即座に反映されるように

---

## [1.0.14] - 2026-01-29

### 修正
- **アプリアイコンの表示を修正**
  - AndroidのadaptiveIconのforegroundImageを`adaptive-icon.png`から`icon.png`に統一
  - 白い3重円になる問題を回避（同一アイコンを利用）
- **メトロノームのバックグラウンド再生を改善**
  - 再生前にAudioContextがsuspendedの場合は`resume()`を呼ぶように変更
  - ハーモニーは鳴るがメトロノームが鳴らない事象の緩和
- **チューナーの検出を改善**
  - FFTサイズを2048→4096に変更（低域分解能向上）
  - 周波数領域を優先し、検出できなければ時間領域（ゼロクロッシング）をフォールバック
  - 放物線補間でピーク周波数の精度を向上
  - 感度閾値を下げて検出しやすく調整
- **プログラム再生画面の再生コントロールを変更**
  - 一時停止を絵文字「⏸」からテキスト「一時停止」に変更
  - 停止を「■」からテキスト「停止」に変更
  - 再生中でもオレンジの四角にしない（playBtnActiveを廃止）
  - 停止ボタンをオレンジではなく neutral な色に変更
- **Android versionCodeを4に更新**

---

## [1.0.12] - 2026-01-29

### 変更
- **アプリ名を「Tutti」に変更**
  - `app.json`: `name` / `slug` / `scheme` を Tutti 用に更新
  - Android `strings.xml`: ランチャー表示名を「Tutti」に更新

---

## [1.0.13] - 2026-01-29

### 修正
- **Android versionCodeを3に更新**
  - Google Play Consoleでバージョンコード2が既に使用されているため、3に更新
- **鍵盤のタッチ位置のズレを修正**
  - 白鍵の幅計算に`marginHorizontal: 1`を考慮
  - 黒鍵の位置計算を修正（白鍵の中央から計算）
  - タッチ座標の計算精度を向上
- **鍵盤の持続音バグを修正**
  - `handleTouchEnd`で確実に音を停止するように改善
  - `handleTouchMove`で音の切り替え処理を改善
- **チューナーの音声検出を修正**
  - `getByteFrequencyData`から`getByteTimeDomainData`に変更
  - ゼロクロッシング法を使用して基本周波数を検出
  - Androidでの音声検出精度を向上
- **バックグラウンド再生の設定反映を修正**
  - `useAudioEngine`の初期化時に`loadSettings`を呼び出し
  - 設定変更時に最新の設定を取得するように改善
  - `useEffect`の依存関係に`loadSettings`を追加
- **メトロノーム画面のUI改善**
  - ヘッダボタンが画面端にくっつかないように`paddingHorizontal`を調整（最小8pxを確保）
- **ハーモニー画面のコードボタンのレイアウト改善**
  - コードボタンとmodeBarの被りを防止（`padGrid`の`paddingTop`を増加）
  - コードボタンとタブバーの被りを防止（`padGrid`の`paddingBottom`を増加、`keyboardPanel`の`paddingBottom`を調整）
  - `container`の`paddingHorizontal`と`paddingVertical`を調整して画面端からの距離を確保

---

## [1.0.11] - 2026-01-29

### 変更
- **コードモード（ChordProgressionPad）のUI改善**
  - キーセレクタとガイドをコード/鍵盤切り替え行（modeBar）に統合
    - コードモード時のみキーセレクタとガイドを表示
    - 鍵盤モード時はコード名/周波数表示を表示
    - キーセレクタの状態を親コンポーネント（harmony.tsx）で管理
  - パッドサイズを大きく改善（I,IV,V: 最小120px、最大150px、ii,iii,vi,vii°: 最小85px、最大110px）
  - パッド間のギャップを`spacing.sm`（8px）に変更して適切な間隔を確保
  - `padGrid`を中央揃えに変更して見やすく配置
  - ボタンがどこにもぶつからないようにレイアウトを調整

---

## [1.0.10] - 2026-01-29

### 変更
- **商標問題の修正**
  - 「ハーモニーディレクター」を「ハーモニー」に変更（ヤマハの商標を避けるため）
    - タブバーの表示名を変更
    - コード内のコメントとドキュメントを更新
    - 設定画面のタイトルを「ハーモニーディレクター設定」→「ハーモニー設定」に変更
- **設定のデフォルト値が画面に反映されるように修正**
  - メトロノーム画面：設定画面で設定したデフォルトテンポ・拍子が反映されるように修正
    - 画面がフォーカスされた時（タブ切り替え時）に設定ストアからデフォルト値を読み込み
    - 現在の値がデフォルト値（テンポ120、拍子4/4）と同じ場合のみ設定を適用（ユーザーの変更を保護）
    - `TEMPO_DEFAULT`のインポートを追加してエラーを修正
    - 重複していた`useFocusEffect`を削除
    - エラーハンドリングとnullチェックを追加
  - ハーモニー画面：設定画面で設定したデフォルトピッチ・調律が反映されるように修正
    - 画面がフォーカスされた時（タブ切り替え時）に設定ストアからデフォルト値を読み込み
    - 現在の値がデフォルト値（ピッチ440Hz、調律平均律）と同じ場合のみ設定を適用（ユーザーの変更を保護）
    - エラーハンドリングとnullチェックを追加
- **ハーモニー画面のレイアウト改善**
  - コード名・周波数表示を鍵盤/コード切り替えスイッチの横に配置（同じ高さで横並び）
  - 鍵盤の高さを調整してヘッダーとタブバーに被らないように修正
    - `keyboardPanel`に`maxHeight`を設定し、利用可能なスペースの80%に制限
    - `PianoKeyboard`コンポーネントに`maxHeight`プロパティを追加して外部から高さを制御可能に
    - `overflow: 'hidden'`を追加して確実にはみ出さないように
  - 鍵盤の下側をタブバーのギリギリまで下げるように調整
- **チューナー画面のUI改善**
  - 開始ボタンのサイズを小さくして上に配置（`paddingVertical`: lg→md、`fontSize`: 24→18）
  - コントロールボタンをコンパクトに（56px→40px）
  - コントロールブロック全体を小さく（`padding`: md→sm、`gap`: md→sm）
  - 青の色味を改善（`#4A90E2` → `#3B82F6`、Tailwind CSS blue-500ベース）
- **メトロノーム画面のUI改善**
  - プリセット保存とその他のボタンの間隔を広げる（`gap`: sm→md）
  - プリセットコンテナに`marginLeft: spacing.md`を追加して音色ボタンとの間隔を確保
  - BPM表示を中央に配置（`controlColumn`に`paddingTop: spacing.lg`を追加）
  - 再生ボタンの三角の位置を調整（`paddingLeft: 2`と`lineHeight`を設定）
- **Androidフォントの修正**
  - Androidで中国語っぽいフォントが表示される問題を修正
    - `typography.ts`で`Platform.OS`をチェックし、Androidでは`sans-serif`を使用
    - Web版とAndroid版でフォントを分岐
- **ボタンのフォントを太字に修正**
  - リセット、保存、読み込みボタンのフォントを`fontWeight: '600'`から`'700'`に変更
  - PresetSelector、プログラム編集画面、プログラム再生画面のボタンを修正
- **アプリアイコンの設定**
  - `test.ico`をアプリのアイコンとして設定（`app.json`で`"./assets/icon.ico"`を参照）

---

## [1.0.9] - 2026-01-28

### 修正
- **ハーモニーディレクター画面のレイアウト改善**
  - 「鍵盤」「コード」切り替えボタンの文字が切れていた問題を修正
    - `MODE_BAR_HEIGHT`を36から44に増加
    - `modeBtn`の`paddingVertical`を8から10に、`paddingHorizontal`を`spacing.md`から`spacing.lg`に増加
    - `modeBtnText`に`lineHeight: 18`を追加
    - `modeSwitcher`の`padding`を3から4に増加
  - コード名/周波数表示が鍵盤に被っていた問題を修正
    - `infoBar`を独立したエリアとして分離（固定高さ`INFO_BAR_HEIGHT = 32`）
    - 鍵盤モード時は常にコード名/周波数表示エリアを確保（音を押していない時はプレースホルダーを表示）
    - `keyboardPanel`の`paddingTop`を`spacing.md`から`spacing.xs`に調整
- **Androidネイティブの音声出力改善**
  - Web Audio APIの利用可能チェックを改善
    - `Platform.OS === 'web'`だけでなく、ネイティブ環境でもAudioContextが利用可能かチェック
    - AudioContext初期化時のエラーハンドリングを追加
    - 初期化成功/失敗時のログ出力を追加

### 注意
- **Androidエミュレーターでの音声出力について**
  - Androidエミュレーターでは、AudioContextがサポートされていない場合があります
  - 音が出ない場合は、実機でのテストを推奨します
  - エミュレーターの設定で「Audio playback」を有効にすることで改善する場合があります

---

## [1.0.8] - 2026-01-28

### 修正
- **チューナー画面の横画面レイアウト改善**
  - 横画面レイアウトで右側のコントロールパネルが見切れていた問題を修正
    - `landscapeLayout`の`paddingHorizontal`を`spacing.lg`から`spacing.sm`に縮小
    - `landscapeControls`に`maxWidth: '40%'`を追加し、`paddingLeft`/`paddingRight`を調整
    - `landscapeControlButton`のサイズを56x56から48x48に縮小
    - `landscapeControlButtonText`のフォントサイズを28から24に縮小
    - `landscapeControlValue`のフォントサイズを24から20に縮小、`minWidth`を100から80に縮小
    - `landscapeControlBlock`の`padding`を`spacing.md`から`spacing.sm`に縮小
    - `landscapeControlRow`の`gap`を`spacing.lg`から`spacing.md`に縮小
    - `landscapeToggleButton`の`paddingVertical`を`spacing.xl`から`spacing.lg`に縮小
- **タブバーのレイアウト改善**
  - タブバーの「設定」タブが見切れていた問題を修正
    - `container`の`paddingHorizontal`を`spacing.md`から`spacing.sm`に縮小
    - `tabText`のフォントサイズを15から13に縮小

### 注意
- **Androidエミュレーターでの音声出力について**
  - Androidエミュレーターでは、デフォルトでオーディオが無効になっている場合があります
  - エミュレーターの設定でオーディオを有効にするか、実機でテストしてください
  - Android Studioのエミュレーター設定で「Audio playback」と「Audio input」を有効にしてください

---

## [1.0.7] - 2026-01-28

### 修正
- **ハーモニーディレクター画面のレイアウト改善**
  - 基準ピッチの右側ボタンが見切れていた問題を修正（`HarmonyControls`の`container`に`paddingRight`を追加）
  - 鍵盤とコードの切り替えボタンの下に鍵盤が被っていた問題を修正（`modeBar`の`marginBottom`を増加、`keyboardPanel`の`paddingTop`を増加）
- **チューナー画面のレイアウト改善**
  - 開始ボタンが見切れていた問題を修正（縦画面・横画面両方で`footer`と`landscapeToggleButton`の`paddingBottom`/`marginBottom`を増加）

---

## [1.0.6] - 2026-01-28

### 修正
- **QRコードインポートモーダルの改善**
  - インポート画面が見切れていた問題を修正（モーダルの`maxHeight`と`maxWidth`を調整、`modalContent`を追加してスクロール可能に）
  - 画面外（モーダル以外の部分）をタップで閉じられるように改善（`Pressable`の`onPress`で`onClose`を呼び出す）
- **メトロノーム画面のレイアウト**
  - メトロノーム画面で見切れが発生していた問題を修正（SafeAreaInsetsの`bottomPadding`を`container`と`mainArea`に適用）

---

## [1.0.5] - 2026-01-28

### 修正
- **プログラム編集画面の画面向き**
  - プログラム編集画面が縦固定になっていた問題を修正（横画面固定に変更）
- **プログラム再生画面のレイアウト**
  - Android環境で画面がはみ出ていた問題を修正（SafeAreaInsetsの`bottomPadding`を適用）
- **画面向き遷移の改善**
  - Metronomeからプログラム画面に遷移する際に縦画面を経由していた問題を修正
  - プログラム一覧・再生画面の`useFocusEffect`から`PORTRAIT_UP`への戻し処理を削除
- **チューナー画面のレイアウト**
  - 開始ボタンが見切れていた問題を修正（縦画面・横画面両方でSafeAreaInsetsの`bottomPadding`を適用）
- **ハーモニーディレクター画面のレイアウト改善**
  - 鍵盤とコードの下側が文字が見切れていた問題を修正（`keyboardPanel`の`paddingBottom`をさらに増加）
  - 音色選択画面でオルガンなどの文字の下にボタンの空白があった問題を修正（`block`の`gap`と`label`の`marginBottom`を調整、`toneRow`の`marginTop`を0に設定）

---

## [1.0.4] - 2026-01-28

### 修正
- **画面向き管理の改善**
  - MetronomeとHarmony Directorを切り替える際に縦画面を経由して横画面に遷移していた問題を修正
  - `home.tsx`で画面向きを統一管理し、各画面の`useFocusEffect`から`PORTRAIT_UP`への戻し処理を削除
  - 設定画面も横画面固定に変更
- **ハーモニーディレクター画面のレイアウト改善**
  - 鍵盤が下側に見切れていた問題を修正（`keyboardPanel`の`paddingBottom`を増加）
  - 和音と鍵盤を切り替えるボタンが鍵盤に被っていた問題を修正（`modeBar`に`zIndex`と`margin`を調整）
  - ヘッダーの3点リーダーボタンが2行目になっていた問題を修正（`transposeRow`の`flexWrap`を削除、サイズ調整）
  - ヘッダーの高さとレイアウトを調整し、横スクロールを見越した配置に最適化
  - `transposeChip`のサイズを調整して横スクロール対応を改善

---

## [1.0.3] - 2026-01-28

### 追加
- **Android ビルド周りの対応**
  - `android/local.properties` に `sdk.dir` を追加（SDK location not found 対策）
  - `docs/SETUP_ANDROID_WINDOWS.md` に Tag mismatch・SDK location・New Arch・expo-barcode-scanner 等のトラブルシュートを追記

### 変更
- **React Native 周り（Expo SDK 54 互換）**
  - `react-native-reanimated` を `~3.16.1` → `~4.1.1`、`react-native-worklets` を追加（Expo 推奨版）
  - `newArchEnabled` を `true` に（Reanimated 4.x / Worklets が New Architecture 必須のため）
- **expo-barcode-scanner 削除**
  - 非推奨かつ New Arch で Kotlin ビルドエラーになるため削除
  - QR コード「ファイルから読み取り」は **Web 版のみ** 対応。ネイティブではカメラスキャンのみ（`QRCodeImportModal`）

### 注意
- Android ビルド初回は **5〜10 分以上** かかることがある。Gradle の `.lck` エラー時は他で動いているビルドを止めてから再実行すること

---

## [1.0.2] - 2026-01-28

### 追加
- **Android Development Build セットアップ**
  - `app.json` に `expo-dev-client` プラグインを追加
  - `npx expo prebuild --platform android` で `android/` フォルダを生成済み
  - `docs/SETUP_ANDROID_WINDOWS.md` を追加（JDK・JAVA_HOME・AVD・`expo run:android` 手順）

### 注意
- `npx expo run:android` 実行には **JAVA_HOME** の設定が必要
- Android Studio インストール後、同梱 JDK のパスを JAVA_HOME に設定し、エミュレータ起動後に再実行すること

---

## [1.0.1] - 2026-01-28

### 修正
- **チューナー機能 - エラー修正**
  - `detectFundamentalFrequency`関数で`sensitivity`パラメータが未定義だったエラーを修正
  - 関数シグネチャに`sensitivity`パラメータを追加（デフォルト値50）
  - 更新ループが正しく動作するように`isActiveRef`を使用して状態を追跡

- **設定画面 - UI改善**
  - ハプティクス設定を削除
  - データエクスポート機能を削除
  - バックグラウンド再生設定を追加

- **ヘルプ画面 - UI改善**
  - ヘッダーに戻るボタンを追加
  - 問い合わせボタンを追加（外部リンクを開く）
  - ヘッダーのレイアウトを修正

- **チューナー画面 - 横画面最適化**
  - 横画面と縦画面で異なるレイアウトを表示
  - 横画面では左側にメイン表示、右側にコントロール（基準ピッチ、感度、開始ボタン）を配置
  - すべての重要な要素が横画面でも見えるように改善

- **ハーモニーディレクター画面 - レイアウト調整**
  - プリセットボタンを横スクロール内に配置し、レイアウトを改善
  - 鍵盤が下のメニューに被らないようにパディングを調整

### 改善
- **バックグラウンド再生機能**
  - 設定画面でバックグラウンド再生のオン/オフを切り替え可能
  - `useAudioEngine`で設定を読み込み、`staysActiveInBackground`を設定に応じて更新
  - 設定変更時にオーディオモードを自動更新

---

## [1.0.0] - 2026-01-28

### 追加
- **チューナー機能**
  - マイク入力から音程を測定し、基準ピッチとの差をセント単位で表示
  - ノート名、周波数、セント差をリアルタイムで表示
  - 針型インジケーターで視覚的に音程を確認
  - 基準ピッチ（A4）を430-450Hzの範囲で調整可能
  - 感度調整機能（0-100）で検出感度を調整可能
  - Web Audio APIを使用したFFT解析による基本周波数検出

- **設定画面**
  - アプリ全体の設定を管理する画面を追加
  - 一般設定（画面常時点灯、バックグラウンド再生）
  - メトロノーム設定（デフォルトテンポ、拍子）
  - ハーモニーディレクター設定（デフォルトピッチ、調律）
  - 設定のリセット機能

- **ユーザープリセット機能**
  - メトロノームとハーモニーディレクターの設定をプリセットとして保存・呼び出し
  - プリセットの保存、読み込み、削除機能
  - メトロノーム画面とハーモニーディレクター画面にプリセット管理UIを追加

- **プログラムテンプレート機能**
  - よく使うプログラムをテンプレートとして保存
  - テンプレートから新規プログラムをワンタップで作成
  - プログラム一覧画面に「テンプレートから作成」ボタンを追加
  - プログラム編集画面に「テンプレートとして保存」ボタンを追加

- **ヘルプ・チュートリアル機能**
  - 初回起動時のチュートリアル画面を追加
  - 各機能の説明とFAQを含むヘルプ画面を追加
  - 初回起動検出機能を実装

- **バックグラウンド再生機能**
  - 設定画面でバックグラウンド再生のオン/オフを切り替え可能
  - アプリがバックグラウンドに移行してもメトロノームが再生を続ける機能

### 変更
- **設定画面のUI改善**
  - ハプティクス設定を削除
  - データエクスポート機能を削除
  - バックグラウンド再生設定を追加

- **ハーモニーディレクター画面**
  - プリセットボタンを横スクロール内に配置し、レイアウトを改善
  - 鍵盤が下のメニューに被らないようにパディングを調整

- **チューナー画面**
  - 横画面固定レイアウトに変更
  - プラス/マイナスボタンのアイコンを中央揃えに修正
  - 文字の重なりを解消

- **メトロノーム画面**
  - プリセットボタンの上に「プリセット」ラベルを追加

### 修正
- **チューナー機能**
  - 開始ボタンを押しても監視が開始されない問題を修正
  - エラーハンドリングを改善
  - 更新ループが正しく動作するように修正

- **設定画面**
  - エラーで開けない問題を修正（Linkコンポーネントの使用方法を修正）

---

## [0.9.33] - 2026-01-28

### 変更
- **ハーモニーディレクター - 音色変更**
  - オーボエの音色を削除し、ピアノの音色を追加
  - ピアノは持続音ではなく、打鍵音（自動的に減衰する音）として実装
    - アタックタイム: 0.01秒（短い立ち上がり）
    - リリースタイム: 1.5秒（自然な減衰）
    - 複数の倍音（基本音 + 2倍音 + 3倍音）を組み合わせて豊かな音色を実現
    - `stopNote`を呼ばなくても自動的に減衰・停止する

### 修正
- **ピアノ音色 - エラー修正**
  - ピアノのオシレーターと倍音オシレーターの`stop()`呼び出し時にエラーが発生していた問題を修正
  - `start()`の後に`stop()`をスケジュールするように順序を修正
  - エラーハンドリングを追加し、既に停止しているオシレーターに対して`stop()`を呼び出さないように改善

### 改善
- **オルガン2音色 - 新しい音色を追加**
  - ピアノ風の音色を「オルガン2」として追加
  - ADSRエンベロープを実装（Attack: 2ms、Decay: 100ms、Sustain: 60%、Release: 2.5秒）
  - 6つの倍音（基本音 + 2倍音40% + 3倍音30% + 4倍音18% + 5倍音12% + 6倍音8%）を追加
  - 非調和性（inharmonicity）を追加（弦の硬さによる周波数のわずかなずれ）
  - 各倍音に異なる減衰率を適用（高域の倍音ほど速く減衰）
  - 二段階減衰を実現（異なる倍音が異なる減衰率で減衰）
  - ハンマーストライクのノイズ成分を追加（短いバーストノイズ、10ms）
  - ローパスフィルタで高域を自然に減衰させ、豊かな音色を実現

### 変更
- **音色の順番変更**
  - 音色の表示順序を「オルガン、オルガン2、フルート、クラリネット」に変更

---

## [0.9.32] - 2026-01-28

### 追加
- **コード進行パッド - ホールド機能**
  - コード画面でも音の持続（ホールド）機能を使用可能に
  - トラックした音でも、その場で押したコードの音でも、ホールドモードが有効な場合は音が持続するように改善
  - コード画面のホールドは「置き換え方式」を採用（鍵盤の「足し算方式」とは異なる）
    - 新しいコードを押すと、既存のコードの音が停止され、最後に押したコードの音だけが持続する
    - これにより、コード進行を試す際に、前のコードの音が残らないように改善
    - すべてのダイアトニックコードの音を確実に停止する処理を追加し、置き換え方式が正しく動作するように改善
  - ホールドモードのスイッチをOFFにした時に、コード画面の音も確実に停止するように改善

### 改善
- **ハーモニーディレクター - クラリネット音色**
  - クラリネットの音色を実際の楽器の特性に基づいて改善
  - 奇数倍音のみを含む閉じた円筒管の特性を再現（矩形波ベース）
  - 第1フォルマント（約1500Hz付近）をピークフィルタで強調（約6dBブースト）
  - ローパスフィルタ（4000Hz、Q=0.7）で高域を適度に減衰
  - より自然なクラリネットの音色を実現

---

## [0.9.31] - 2026-01-28

### 修正
- **コード進行パッド - 純正律の適用**
  - 純正律が正しく適用されていなかった問題を修正
  - コードの各音（Root, 3rd, 5th）をコードのルート音を基準に純正律で計算するように修正
  - 長3度（M3）: 5/4 = 1.25（平均律より約14セント低い）
  - 完全5度（P5）: 3/2 = 1.5（平均律より約2セント高い）
  - 純正律設定時に、コードの構成音が正しい純正和音の比率で鳴るように改善

---

## [0.9.30] - 2026-01-28

### 改善
- **ハーモニーディレクター - オルガン音色**
  - オルガン音を本物のオルガンに近づけるため、複数の倍音を組み合わせるように改善
  - 基本音（矩形波）+ 2倍音（オクターブ上、25%音量）+ 3倍音（12度上、15%音量）を合成
  - ローパスフィルタ（frequency * 6、Q=0.5）を適用して自然な倍音構造を実現
  - 即座に立ち上がるアタックタイム（0.001秒）でパイプオルガンの特性を再現
  - 倍音の音量調整にも対応
- **メトロノーム - クリック音**
  - デフォルト音色をHD200のような聞こえやすいクリック音に改善
  - 周波数を1500Hz（通常）/1800Hz（アクセント）に引き上げ
  - 矩形波を使用してより明確な音に変更
  - アタックタイムを0.0005秒に短縮して鋭いクリック感を実現
  - 持続時間を短縮（0.02秒/0.025秒）してクリック感を強調
  - 指数関数的な減衰エンベロープでより明確なクリック感を実現

---

## [0.9.29] - 2026-01-28

### 変更
- **QRコードインポート機能**
  - インポートボタンをプログラム編集画面からプログラム一覧画面に移動
  - インポートしたプログラムがプログラム一覧に追加されるように改善

---

## [0.9.28] - 2026-01-28

### 修正
- **プログラムメトロノーム再生画面**
  - 矢印をStackのヘッダーに変更（プログラム編集画面と統一）
  - 不要なスタイルを削除
- **QRコードインポート機能**
  - インポート時に新しいIDを生成するように修正
  - インポートしたプログラムが既存のプログラムとIDが重複しても新しいプログラムとして追加されるように修正
  - デバッグログを追加

---

## [0.9.27] - 2026-01-28

### 修正
- **プログラム一覧画面**
  - ヘッダータイトルを「プログラム一覧」に戻す
- **プログラム編集画面**
  - 独自の戻るボタンを削除し、Stackのヘッダーを使用（矢印スタイルを統一）
  - 謎の空白を削除
  - インポート完了時のアラートをWeb対応に修正
- **QRコードインポートモーダル**
  - デバッグログを追加してインポート処理を確認可能に

---

## [0.9.26] - 2026-01-28

### 修正
- **プログラム編集画面**
  - 矢印のスタイルをプログラムメトロノーム再生画面と統一（絶対配置で上に配置）
- **QRコードインポートモーダル**
  - Web環境での「Image.default is not a constructor」エラーを修正
  - `react-native`の`Image`インポートを削除し、`document.createElement('img')`を使用
  - Web環境でのQRコード読み取り処理を改善

---

## [0.9.25] - 2026-01-28

### 修正
- **プログラム一覧画面**
  - ヘッダーから「← 戻る」ボタンを削除
  - ヘッダータイトルを「プログラムメトロノーム」に変更
  - ヘッダーの幅感をプログラム編集画面と統一
- **プログラム編集画面**
  - 戻るボタンを「← 戻る」から「←」のみのスタイルに変更
  - ヘッダーの幅感をプログラム一覧画面と統一
- **プログラムメトロノーム再生画面**
  - 矢印の黒い丸を削除（背景色を削除）
  - 矢印の色をアクセントカラーに変更
- **QRコードインポートモーダル**
  - Web環境でのファイル読み込み処理を改善
  - FileReaderを使用してファイルを読み込むように修正
  - エラーハンドリングを改善

---

## [0.9.24] - 2026-01-28

### 修正
- **プログラム編集画面**
  - ヘッダータイトルを「プログラム編集」に変更（プログラム名ではなく）
  - 黒い丸の戻るボタンを通常のテキストボタン「← 戻る」に変更
  - インポート・エクスポートボタンにテキストラベルを追加
- **QRコードエクスポートモーダル**
  - モーダル幅を90%に変更し、見切れを防止
  - Web用ダウンロード機能を修正（QRCodeのtoDataURLを使用）
- **QRコードインポートモーダル**
  - モーダル幅を90%に変更し、見切れを防止
  - Web環境でのエラーメッセージを`window.alert`で表示

---

## [0.9.23] - 2026-01-28

### 修正
- **プログラム編集画面**
  - ヘッダーUIをプログラムメトロノーム画面と統一
  - プログラム名をヘッダーに表示
  - ボタンをコンパクトなデザインに変更
  - Web環境での保存・削除ボタンが動作しない問題を修正（`window.confirm`/`window.alert`を使用）
- **プログラム一覧画面**
  - Web環境での削除ボタンが動作しない問題を修正（`window.confirm`を使用）

---

## [0.9.22] - 2026-01-28

### 修正
- **プログラム編集画面**
  - 謎の矢印（Stackヘッダーの戻るボタン）を削除（`headerShown: false`を設定）
  - 保存ボタンが動作しない問題を修正（`updateCurrentProgram`と`setCurrentProgram`を追加）
  - 削除ボタンが動作しない問題を修正（エラーハンドリングを追加）
  - エラーメッセージを改善
- **プログラム一覧画面**
  - ボタンが動作しない問題を修正（エラーハンドリングを追加）
  - 削除ボタンのエラーハンドリングを改善

---

## [0.9.21] - 2026-01-28

### 修正
- **QRコードエクスポート**
  - Webでのダウンロード処理を改善（ViewShotのキャプチャ結果を確実にダウンロード）
  - data URIとblob URLの両方に対応
  - エラーハンドリングを改善
- **QRコードインポート**
  - インポート後にプログラムを保存してから設定するように修正
  - モーダルが消えるだけで読み込まれない問題を修正
- **プログラムテキスト入力**
  - 余白を調整（paddingをspacing.lgからspacing.mdに変更）
  - ヘッダーとアクションボタンのpaddingを調整
- **プログラム編集画面**
  - 戻るボタンを上の矢印（StatusBarの上）に統一
  - プログラム削除ボタンを追加
  - 削除確認ダイアログを追加
- **プログラムメトロノーム画面**
  - 戻るボタンを上の矢印（StatusBarの上）に統一
  - UIをプログラム編集画面と統一

---

## [0.9.20] - 2026-01-28

### 修正
- **QRコードエクスポート**
  - ダウンロード/共有ボタンから絵文字を削除
  - Webでのダウンロード処理を改善（data URIとblob URLの両方に対応）
  - `document.body.appendChild`と`removeChild`を使用して確実にダウンロード
- **QRコードインポート**
  - WebプラットフォームでのQRコード読み取りを修正
  - `jsqr`ライブラリを使用してWebで画像からQRコードを読み取り
  - ネイティブでは`BarCodeScanner.scanFromURLAsync()`を継続使用
  - エラーメッセージを改善して詳細な情報を表示
  - Blob URLとData URIの両方に対応
  - FileSystemのフォールバック処理を追加
- **プログラムテキスト入力**
  - 構文ヘルプを開いた際のはみ出しを完全に修正
  - モーダル内のコンテンツを`ScrollView`で囲み、ヘッダーとアクションボタンは固定
  - `keyboardShouldPersistTaps="handled"`を追加してキーボード操作を改善
  - `flexGrow`と`flexShrink`を使用してScrollViewの動作を改善
- **戻るボタン**
  - `hitSlop`を追加してタッチ領域を拡大（上下左右10px）

---

## [0.9.19] - 2026-01-28

### 修正
- **QRコードインポート**
  - JSONファイルタイプを削除し、PNG/JPEG画像ファイルのみに変更
  - `BarCodeScanner.scanFromURLAsync()`を使用して画像ファイルからQRコードを読み取り
- **QRコードエクスポート**
  - ダウンロード/共有ボタンを追加
  - Webではダウンロード、iOS/Androidでは共有シートを使用
  - `react-native-view-shot`と`expo-sharing`を使用
- **プログラムテキスト入力**
  - 構文ヘルプを開いた際のプレビューのはみ出しを修正
  - `ScrollView`の`contentContainerStyle`を使用してレイアウトを改善
- **プログラムメトロノーム**
  - 小節カウントが進まないバグを修正
  - `position?.measure`を`position?.measureInSection`に修正
  - `position?.beat`を`position?.beatInMeasure`に修正

---

## [0.9.18] - 2026-01-28

### 追加
- **プログラムテキスト入力機能**
  - `4/4(8)-3/4(4)-2+2+3/8(2)@100` のような構文でプログラムを入力可能
  - リアルタイムでパースしてプレビュー表示
  - 構文エラーは位置と修正方法を提示
  - 変拍子（2+2+3/8形式）にも対応
  - テンポ指定（@120）も可能

### 変更
- **QRコードインポート**
  - テキスト入力を削除し、ファイル選択に変更
  - `expo-document-picker`を使用
  - JSONファイルまたはQRコードデータファイルをインポート可能
- **コード進行パッド音色対応**
  - ハーモニーディレクターの音色設定がコード再生にも適用されるように
- **メトロノーム音色をより明確に**
  - default: サイン波、標準的な周波数（800/1000Hz）
  - hard: 矩形波、高い周波数（1000/1200Hz）、鋭いアタック
  - wood: サイン波、低い周波数（500/700Hz）、ローパスフィルター

---

## [0.9.17] - 2026-01-28

### 修正
- **コード進行パッド（ChordPad）**
  - Root/3rd/5th フォーカス時に他の音を完全ミュート（0.1→0.0）
  - 単音のみが聞こえるように改善
- **ハーモニーディレクター音色変更**
  - 音が鳴っている状態で音色を変更すると即座に反映されるように
  - `handleToneChange`で再生中の音を新しい音色で再生成
- **ピアノ鍵盤スライドバグ**
  - スライド操作時に全ての音が持続されるバグを修正
  - ホールドモード以外では常に1音のみが鳴るように
- **メトロノーム音色変更**
  - 再生中でも音色変更が即座に反映されるように
  - リアルタイムで最新のtoneを取得して再生
- **メトロノーム拍分割の音色**
  - 拍分割（8分、3連、16分）も音色変更に追従
  - `playSubdivisionClick`にtoneパラメータを追加
- **メトロノーム強拍**
  - 1拍目の強拍が出ない問題を修正
  - `tick()`後の`currentBeat`で正しく判定
  - `playClick`で周波数が設定されていなかったバグを修正

---

## [0.9.16] - 2026-01-28

### 修正
- QRコードエクスポート・インポート機能のバグ修正
  - Base64エンコード時のUnicode文字（日本語）対応
  - `TextEncoder`/`TextDecoder`を使用してUTF-8エンコード/デコード
  - プログラム編集画面のエラー修正（未定義変数の追加）

### 追加
- **QRコードライブラリの実装**
  - `react-native-qrcode-svg`: QRコード生成
  - `react-native-svg`: SVGレンダリング（依存関係）
  - `expo-camera`: QRコードスキャン用カメラ
  - `expo-barcode-scanner`: バーコードスキャン（補助）
  - QRコードエクスポートモーダルで実際のQRコードを表示
  - QRコードインポートモーダルでカメラスキャン機能実装
  - カメラ権限のリクエストとエラーハンドリング

---

## [0.9.15] - 2026-01-28

### 追加
- **プログラムにリタルダンド・アッチェレランドを組み込み可能に**
  - セクション編集でテンポ変化を設定可能
  - 「次のセクションまで変化」オプション対応
  - 目標テンポを指定して徐々に変化
- **1小節ごとに拍子が変わる曲の入力支援**
  - 「拍子シーケンス」機能で各小節の拍子を一括設定
  - アルメニアンダンスのような曲に対応
  - 1セクションを複数の1小節セクションに自動分割
- **QRコードでプログラムのエクスポート・インポート**
  - プログラム編集画面に「エクスポート」「インポート」ボタン追加
  - QRコードとして表示（ライブラリ実装必要）
  - QRコードスキャンでインポート（ライブラリ実装必要）
  - データ直接入力でもインポート可能

### 変更
- **メトロノームUIをさらに大きく**
  - コントロールボタン: padding 12px、fontSize 24px
  - テンポ調整ボタン: padding 14px、fontSize 18px
  - 再生ボタン: 80×80px、fontSize 36px
  - モード切替ボタン: padding 12px、fontSize 16px
- **メトロノーム音色変更ボタンをわかりやすく**
  - ラベルを「音色: 通常」「音色: 硬め」「音色: 木」に変更
  - アイコンとテキストで明確に表示
- **プログラム再生画面からリタルダンド・アッチェレランドボタンを削除**
  - プログラム内に組み込まれたテンポ変化を使用

---

## [0.9.14] - 2026-01-28

### 追加
- **音色機能を変更**（オルガン、フルート、クラリネット、オーボエ）
  - オルガン: 矩形波ベース
  - フルート: サイン波 + 低域フィルタ
  - クラリネット: 矩形波 + 中域強調フィルタ
  - オーボエ: のこぎり波 + 高域強調フィルタ
- **Bluetoothペダル対応**（ホールド制御）
  - 外部ペダルデバイスでホールドモードを制御可能
  - 現在はキーボードイベント（スペースキー）でシミュレート
- **メトロノーム音色選択機能**
  - 通常（デフォルト）: サイン波
  - 硬め: 矩形波
  - 木: 短いパルス + 低域フィルタ（リアルなメトロノーム音）
- **プログラムメトロノームでリタルダンド・アッチェレランド**
  - 再生中にテンポ倍率を調整可能（0.5x - 2.0x）
  - リタルダンド（減速）とアッチェレランド（加速）ボタン

### 変更
- **メトロノームUIを大きくタッチしやすく**
  - コントロールボタン: padding 8px、fontSize 18px
  - テンポ調整ボタン: padding 10px、fontSize 16px
  - 再生ボタン: 64×64px、fontSize 28px
  - モード切替ボタン: padding 8px、fontSize 14px

---

## [0.9.13] - 2026-01-28

### 追加
- **音色機能を追加**（5種類）
  - サイン波（純粋な音）
  - 矩形波（明るい音）
  - のこぎり波（豊かな倍音）
  - 三角波（柔らかい音）
  - フルート風（楽器風の音色）
  - HarmonyControlsに音色選択UIを追加

### 変更
- **HarmonyControlsのUI改善**
  - すべてのボタンを大きく（押しやすく）
  - **トランスポーズUI改善**
    - C, Bb, Eb, Fを直接選択可能
    - 「…」ボタンで12調すべてを選択できるモーダルを表示
  - 音色選択を追加（横スクロール）
- **モード切り替えボタンの改善**
  - ボタンサイズを大きく（minWidth: 80px, padding: 8px）
  - 絵文字を削除（「鍵盤」「コード」のみ）
- **コード進行パッドのレイアウト改善**
  - I, IV, Vを大きく（メインコード）
  - ii, iii, vi, vii°を小さく（セカンダリコード）
  - ボタンサイズをさらに大きく（最大130px）
  - 余白を最小化（4px）

---

## [0.9.12] - 2026-01-28

### 変更
- コード進行パッドの改善
  - **12調すべてにトランスポーズ対応**（C, C#/Db, D, Eb, E, F, F#/Gb, G, Ab, A, Bb, B）
  - キーセレクタ（◀ ▶ボタン）で簡単にキー変更
  - **ボタンを大きく、余白を最小化**
    - 横画面サイズに応じて動的にパッドサイズを計算
    - スクロールを完全に排除（2行×4/3配置）
  - レイアウト最適化
    - 上段: I, ii, iii, IV
    - 下段: V, vi, vii°

---

## [0.9.11] - 2026-01-28

### 追加
- **コード進行パッド機能（吹奏楽ピッチ練習用）**
  - ハーモニーディレクター画面に「コード」モードを追加
  - ダイアトニックコード（I, ii, iii, IV, V, vi, vii°）をワンタッチで再生
  - **ジェスチャーによる音のフォーカス機能**
    - タップ＆ホールド: Full Chord（Root + 3rd + 5th）再生
    - 上ドラッグ: Root Only（3rd, 5thをミュート）
    - 左ドラッグ: 3rd Only（Root, 5thをミュート）
    - 右ドラッグ: 5th Only（Root, 3rdをミュート）
    - 離す: 発音停止
  - ハプティクスフィードバック（モード切替時に振動）
  - ビジュアルフィードバック（モードに応じて色が変化）
  - ハモディレの設定（周波数、オクターブ）を共有

### 変更
- オーディオエンジンに`setNoteVolume`関数を追加（再生中の音量変更対応）
- ハーモニーディレクター画面に「鍵盤/コード」モード切り替えボタンを追加

---

## [0.9.10] - 2026-01-28

### 変更
- プログラム再生画面のプログレスバー改善
  - **カウントイン（予備カウント）を除外して計算**
    - プログレスバーがカウントイン中は進まなくなった
    - 演奏開始から進み始める
  - **パーセント表示から演奏時間表示に変更**
    - `0:00 / 3:24` 形式で経過時間/総演奏時間を表示
    - カウントインは演奏時間に含まれない

---

## [0.9.9] - 2026-01-28

### 変更
- プログラム再生画面の視覚的フィードバック強化
  - **2カラムレイアウトに変更**
    - 左パネル: 現在の再生情報（ビートパルス、テンポ、小節表示）
    - 右パネル: セクションリスト（縦スクロール）
  - **小節が進んでいく感じを視覚化**
    - セクション内プログレスバーを追加（現在の小節がどこまで進んだか）
    - 各セクション行にも進行状況バー（背景で進む）
    - 小節番号を大きく目立つ表示に
  - **メトロノーム同等の視覚情報**
    - ビートパルスを追加（拍に合わせて光る）
    - テンポを大きく表示
    - 拍インジケーターを追加
    - ハプティクスフィードバック追加
  - **全体プログレスバーにパーセント表示**
- セクション編集モーダルの横画面最適化
  - 横幅を700pxに拡大（横画面時）
  - 2カラムレイアウト（左: 基本設定、右: 拍子・アクセント）
  - スクロール不要のコンパクトなレイアウト
  - ヘッダーに保存/キャンセルボタンを移動

---

## [0.9.8] - 2026-01-28

### 変更
- 拍分割モーダルにスライダーを復活
  - ON/OFFボタンだけでなくスライダーで音量調整可能に
  - 中央ポップアップ形式でスクロール不要
- プログラムメトロノームの横画面最適化
  - **プログラムリスト画面**
    - 横画面固定に変更
    - 2カラム表示でコンパクトに
    - ヘッダーを簡素化
  - **プログラム再生画面（Ensemble Friends風）**
    - 横画面固定に変更
    - セクションをテーブル/グリッド形式で表示
    - 現在再生中のセクションをハイライト
    - 上部に再生コントロール（リセット/再生/停止）
    - 下部にプログレスバー
    - 再生中の拍インジケーターを表示

---

## [0.9.7] - 2026-01-28

### 変更
- メトロノーム画面のさらなるUI/UX改善
  - **BeatIndicator（拍インジケーター）の視認性向上**
    - 全拍でアクティブ時に明るく光るように改善
    - ボーダーとグロー効果を追加して視認性UP
    - アクセント拍はより強く光る
  - **1拍子（1/4）を追加**
    - 拍子選択に1/4拍子を追加
  - **振り子モードを大きく表示**
    - 振り子サイズを画面高さの70%（最大180px）に拡大
    - ビートパルスは45%（最大100px）でコンパクトに
  - **拍分割モーダルを中央表示に変更**
    - 右からスライドインする形式から中央ポップアップに変更
    - スクロール不要のコンパクトな4ボタン形式
    - タップでON/OFF切り替え、音量%表示
  - **TAPテンポをBPMの近くに配置**
    - ±ボタンの中央にTAPボタンを配置
    - テンポ調整の一連の操作がしやすく
  - **BPMのキーボード入力に対応**
    - BPM表示をタップすると数値入力モードに
    - 直接テンポを入力可能（20-300 BPM）

---

## [0.9.6] - 2026-01-28

### 変更
- メトロノーム画面の大幅なUI/UXブラッシュアップ
  - **横画面固定に変更**
    - 縦画面から横画面に変更（ハモディレと統一）
    - 画面遷移時に自動で横画面にロック
  - **表示モード切替機能を追加**
    - デフォルト: ビートパルス（丸）- シンプルで視覚的にテンポが分かる
    - オプション: 振り子モード - 従来のメカニカルメトロノーム風表示
    - 右上のトグルボタンで切り替え可能
  - **スクロールなしの2カラムレイアウト**
    - 左カラム: ビジュアル表示（ビートパルス/振り子）
    - 右カラム: テンポ表示、再生/停止、±ボタン、拍インジケーター
    - 上段コントロールバー: 拍子、拍分割、タップテンポ、プログラムリンク
  - **コンパクト化でスマホ横画面に収まるサイズに**
    - ビジュアルサイズを画面高さに応じて自動調整
    - テンポフォントサイズを画面高さに応じて自動調整
    - `BeatIndicator`にコンパクトモードを追加
  - **拍子選択をモーダル化**
    - 画面スペースを節約
    - タップで拍子選択モーダルを表示

---

## [0.9.5] - 2026-01-28

### 修正
- ハーモニーディレクター（ハモディレ）タッチ反応とスマホ対応の改善
  - **鍵盤が押せないことがある問題を修正**
    - `measureInWindow`による位置測定を`useState`で管理するように変更
    - タッチ開始時にレイアウトが未測定の場合は再測定を試みる
    - 画面サイズ変更時に自動的にレイアウトを再測定
    - 座標判定に少し余裕を持たせて境界付近のタッチを改善
  - **スマホサイズ（iPhone SE〜Pro Max）でのレイアウト最適化**
    - 横画面時の利用可能高さを正確に計算（コントロール56px + infoBar48px + パディング）
    - 鍵盤の高さを140px〜260pxの範囲で自動調整
    - コントロールパネルをコンパクト化（ボタンサイズ、フォントサイズ、パディング削減）
    - infoBarを36pxに縮小してスペース確保
    - 横画面時のSafeAreaパディングを最小化

---

## [0.9.4] - 2026-01-28

### 修正
- ハーモニーディレクター（ハモディレ）UI/UX改善
  - **コントロールボタンを左右均等に配置**
    - 横スクロールバー内で`justifyContent: 'space-evenly'`を適用
    - 画面幅全体にボタンが均等に分散されるように修正
  - **コード名/Hz表示時に鍵盤が動かないように修正**
    - 表示エリアを固定高さ（36px）で常に確保
    - コード名、Hz表示、空の状態すべてで同じ高さを維持
    - 鍵盤の位置が表示内容によってシフトしなくなった

---

## [未リリース]

### 追加予定
- メトロノーム機能
  - 基本メトロノーム（テンポ、拍子設定）
  - 視覚的ビート表示（振り子アニメーション）
  - タップテンポ機能
  - プログラムメトロノーム（複数セクション設定）
  
- ハーモニーディレクター機能
  - 2オクターブピアノ鍵盤
  - 音域移動（C1〜C7）
  - 平均律/純正律切替
  - 基準ピッチ設定（A=440Hz±）
  - マルチタッチ対応（和音演奏）

- UI/UX
  - ダークモードベースのデザイン
  - プロフェッショナルなアニメーション
  - 触覚フィードバック

---

## [0.9.3] - 2026-01-28

### 変更
- ハーモニーディレクター（ハモディレ）UI/UX改善（Tonica 参考）
  - **コントロールを上段に横並び化**
    - 左詰め集約をやめ、基準ピッチ・移調・音の持続・音域・調律を横並びに配置
    - `useSafeAreaInsets` でノッチ／Dynamic Island を避け、押しやすく調整
    - 横スクロール可能なトップバーで、小さい画面でもはみ出しを防止
  - **鍵盤を大きく**
    - 白鍵高さを縦 240px・横 220px 以上に変更（従来は 180 / 200）
    - コントロール上段化に合わせて幅を全幅利用し、鍵盤領域を拡大
  - **レイアウト簡素化**
    - 横画面時の左コントロールパネル・右ステータスパネルを廃止
    - 縦／横とも「上: コントロール → コード表示（任意）→ 鍵盤」の共通レイアウトに統一

---

## [0.9.2] - 2026-01-28

### 修正
- Expo Goでのルーティング問題を修正
  - `+not-found.tsx`を削除（ルートとして優先されていた問題を解決）
  - `index.tsx`を`home.tsx`にリネーム（expo-routerが`index.tsx`を認識しない問題を回避）
  - 新しい`index.tsx`で`/home`へのリダイレクトを設定
  - `_layout.tsx`で`index`、`home`、`program`を明示的に定義
  - **注意**: expo-router v6とExpo Goの互換性問題により、`index.tsx`がSitemapに表示されない問題を回避するため、`home.tsx`を使用

---

## [0.9.1] - 2026-01-28

### 修正
- Development Buildセットアップ手順の改善
  - `app.json`で`expo-dev-client`プラグインを有効化
  - `SETUP_MAC.md`に`npx expo prebuild`の手順を追加
  - `ios`フォルダが存在しない場合の対処法を明確化

---

## [0.9.0] - 2026-01-28

### 変更
- UI/UX改善 - タブナビゲーションとレイアウト最適化
  - メニューから移動する形式からタブベースのナビゲーションに変更
    - ホーム画面にタブバーを追加（画面下部に配置）
    - MetronomeとHarmony Directorをタブで即座に切り替え可能
    - リハーサル中に両機能を素早く切り替えて使用できるように改善
  - メトロノーム画面のUI/UX改善
    - スクロールを削減し、画面内に主要機能を配置
    - 拍分割（サブディビジョン）設定をモーダル化
      - `SubdivisionModal`コンポーネントを追加
      - 右側からスライドインするモーダルで音量調整
      - アニメーション付きでスムーズな表示/非表示
    - レイアウトの最適化
      - 振り子とビートパルスのサイズを調整
      - 各セクションの間隔を最適化
      - スクロール不要なコンパクトなレイアウトに変更

### 追加
- `TabBar`コンポーネント（`components/ui/TabBar.tsx`）
  - MetronomeとHarmony Directorを切り替えるタブバー
  - アクティブなタブを視覚的に強調表示
- `SubdivisionModal`コンポーネント（`components/metronome/SubdivisionModal.tsx`）
  - 拍分割設定をモーダルで表示
  - react-native-reanimatedを使用したスムーズなアニメーション
  - 左右どちらからでもスライドイン可能

---

## [0.8.2] - 2026-01-28

### 修正
- 16分音符が正しく4つ鳴らない問題を修正
  - `playSubdivisionClick`で拍頭の音がスキップされていた問題を修正
  - 16分音符: 4つ、3連符: 3つ、8分音符: 2つが正しく鳴る
- ルーティング問題の追加対策（iPhone/Expo Go対応）
  - `+not-found.tsx` を追加（デバッグ用、どのパスがマッチしないか表示）
  - ホーム画面のナビゲーションを `Link` から `useRouter.push()` に変更
  - `newArchEnabled`を`false`に変更（新アーキテクチャがExpo Goと互換性問題）
  - `_layout.tsx`に`+not-found`を明示的に追加
  - `metro.config.js`を追加（Metroバンドラーの設定を明示化）

### 追加
- Development Build対応
  - `expo-dev-client`を追加（Expo Goの制限を回避）
  - `app.json`に`expo-dev-client`プラグインを追加
  - **注意**: expo-router v6はExpo Goと互換性問題があるため、Development Buildの使用を推奨

---

## [0.8.1] - 2026-01-28

### 修正
- 振り子アニメーションの改善
  - 軸を下側に変更（実際のメカニカルメトロノームと同じ構造）
  - 拍ごとに左右交互に振れるように修正（1拍 = 片道）
  - 上端の重りが振り子のように揺れる自然な動き
- 拍分割（サブディビジョン）の動作改善
  - 16分音符が正しく4つ鳴るように修正（拍頭も含む）
  - 8分音符は2つ、3連符は3つ、16分音符は4つ
  - リアルタイム音量調整の実装（スライダー操作中もリセットせず反映）
  - 音量は鳴らす瞬間にstoreから取得（フェードイン/アウトがスムーズ）
- ルーティング問題の修正（iPhone対応）
  - `app/program/_layout.tsx` を追加
  - expo-routerのネストルーティングに正しく対応

---

## [0.8.0] - 2026-01-28

### 追加
- メトロノーム拍分割（サブディビジョン）機能
  - 4分音符、8分音符、3連符、16分音符の4種類の分割に対応
  - 各分割タイプごとに個別の音量スライダーで調整可能
  - 分割タイプごとに異なる周波数で鳴り分け
    - 4分音符: 1000/800Hz（アクセント/通常）
    - 8分音符: 600Hz
    - 3連符: 500Hz
    - 16分音符: 400Hz
  - タップでオン/オフを簡単に切り替え
- `SubdivisionControl` コンポーネント
- 型定義追加: `SubdivisionType`, `SubdivisionSettings`

### 変更
- `useMetronomeStore` を拡張（分割設定の状態管理）
- `useMetronome` フックを拡張（分割音のスケジューリング）
- `useAudioEngine` に `playSubdivisionClick` 関数を追加

### 依存関係
- `@react-native-community/slider` を追加

---

## [0.7.2] - 2026-01-27

### 変更
- 画面遷移の構成変更
  - ホームメニューから「プログラム」を削除
  - メトロノーム画面内に「プログラムメトロノーム」へのリンクを追加
  - プログラムメトロノームはメトロノーム機能の一部として位置づけ
- 画面の向き固定
  - メトロノーム画面: 縦画面固定
  - ハーモニーディレクター画面: 横画面固定
- メトロノームの状態管理改善
  - 画面遷移時にメトロノームを自動停止
  - 画面に入った時に前の再生状態をリセット
- ライトモード対応
  - StatusBarをダークスタイルに変更
  - スプラッシュ画面の背景色を#F8F9FAに変更
  - app.jsonのuserInterfaceStyleをlightに変更
- Web対応を削除（スマホ・タブレット向けに最適化）

---

## [0.7.1] - 2026-01-27

### 変更
- メトロノームの振り子アニメーション改善
  - 実際のメトロノームの物理的な動きを再現
  - テンポに応じた振れ幅の調整（速いほど小さく）
  - 物理的に正確なイージング関数（単振動に近い動き）
  - 停止時の自然な減衰アニメーション
  - 視覚的な改善（影、ボーダー、より洗練されたデザイン）

---

## [0.7.0] - 2026-01-27

### 変更
- UI/UX改善 - シンプルで洗練されたデザイン
  - 絵文字の削除
    - ホーム画面から絵文字（🎵, 🎹, 📋）を削除
    - メトロノーム画面から絵文字（🔊, 🔇, 📳）とステータスバーを削除
    - ハーモニーディレクター画面から絵文字（🔒, 🔓, 🔊, 👁, 📱）を削除
    - HarmonyControlsからホールドボタンの絵文字とヒントテキストを削除
    - プログラム画面から絵文字（📋）を削除
  - レイアウトの簡略化
    - メトロノーム画面の情報セクション（拍子・1拍の表示）を削除
    - ハーモニーディレクター画面の音声状態表示とヒントテキストを削除
    - ホーム画面の説明文を削除し、メニューアイテムをシンプルに
  - 余白の最適化
    - 全画面のパディングとマージンを調整
    - コンポーネント間の間隔を統一
    - よりミニマルなデザインに調整
  - タイポグラフィの改善
    - フォントサイズを調整（displayLarge: 72→64、heading: 24→20など）
    - フォントウェイトを調整（より洗練された見た目に）
    - レタースペーシングを追加
  - デザインの洗練
    - ホーム画面のカードデザインを改善（ボーダーを細く）
    - ボタンサイズとパディングを最適化
    - 全体的にシンプルでプロフェッショナルな見た目に
  - カラーパレットの刷新（ライトモード）
    - ダークモードからライトモードに変更
    - 背景色: 目に優しいオフホワイト（#F8F9FA, #FFFFFF, #EDF2F7）
    - アクセントカラー: ゴールドから明るいブルー（#4A90E2）に変更
    - 機能別カラーの導入
      - rhythm: #FF9F43（オレンジ）- メトロノーム・リズム系
      - harmony: #2ECC71（グリーン）- ハーモニー・純正律
      - stop: #FF7675（ソフトレッド）- 停止・リセット
    - テキスト色: チャコールグレー（#2D3436, #636E72, #B2BEC3）
    - 境界線カラーの追加（#DFE6E9, #B2BEC3）
    - 鍵盤色: 白鍵（#FFFFFF）、黒鍵（#2D3436）

---

## [0.6.0] - 2026-01-27

### 追加
- UI/UXブラッシュアップ（Phase 6）
  - 共通UIコンポーネント
    - `Button` - アニメーション付きボタン（primary/secondary/outline/ghost/danger）
    - `Card` - カードコンポーネント（タップ可能、影付き）
    - `IconButton` - アイコンボタン
    - `LoadingOverlay` - ローディングオーバーレイ
  - アニメーション（react-native-reanimated）
    - `Pendulum` - 振り子アニメーション（テンポに連動）
    - `BeatPulse` - ビートパルスエフェクト
    - ボタン/カードのスケールアニメーション
  - `useHaptics` フック - 振動フィードバック
    - ビート時の振動（アクセントは強め）
    - ボタンタップ時の振動
  - `useKeepAwake` フック - 画面常時点灯
    - メトロノーム再生中
    - プログラム再生中
  - メトロノーム画面に振り子とビートパルスを追加

### 変更
- babel.config.js に reanimated プラグインを追加

---

## [0.5.1] - 2026-01-27

### 追加
- 変拍子のアクセントパターン機能
  - `Section`型に`accentPattern`フィールドを追加
  - 例: `[2, 3]`で5拍子を2+3に分割（1拍目と3拍目にアクセント）
  - セクション編集UIにアクセントパターン設定を追加
  - プリセット（2+3, 3+2, 2+2+3 など）から選択可能
  - 拍インジケーターでアクセント位置を視覚的に表示
  - `isAccentBeat()`, `getAccentBeats()` ユーティリティ関数

### 変更
- `colors.ui`を追加（success, error, warning, info）

---

## [0.5.0] - 2026-01-27

### 追加
- プログラムメトロノーム（Phase 5）
  - `programUtils.ts` - プログラム操作ユーティリティ
  - `useProgramStore.ts` - AsyncStorage連携のZustandストア
  - `useProgramMetronome.ts` - プログラム再生フック
  - プログラムリスト画面（`app/program/index.tsx`）
    - プログラム一覧表示
    - 新規作成・削除
    - 推定再生時間表示
  - プログラム編集画面（`app/program/[id].tsx`）
    - セクション追加・編集・削除・複製
    - プログラム名編集
  - プログラム再生画面（`app/program/play.tsx`）
    - リアルタイム進行状況表示
    - セクションジャンプ機能
    - 拍・小節インジケーター
  - UIコンポーネント
    - `SectionItem` - セクションリストアイテム
    - `SectionEditor` - セクション編集モーダル
    - `ProgramProgress` - 進行状況表示
  - セクション設定
    - セクション名、テンポ、拍子、小節数
    - カウントイン機能（セクションごと）

---

## [0.4.3] - 2026-01-27

### 変更
- 純正律の動作を改善
  - **単音は常に平均律で鳴る**（純正律モードでも）
  - **和音を鳴らすと自動的に調を判定し、ルート音を平均律で基準にして純正和音を構築**
  - **一度和音を鳴らしたら、その和音の音が全て消えるまで調をキープ**
  - 例：ファ・ラ・ドを鳴らす → Fメジャーを判定 → Fを平均律で基準 → F-A-Cを純正和音として計算
  - 例：ファとドを解除してもラだけ残る → ラはFメジャーの純正律で計算され続ける（平均律に戻らない）
  - 例：全ての音が消えると調もリセット → 次の和音で新しい調を判定

---

## [0.4.2] - 2026-01-27

### 追加
- トランスポーズ機能
  - 楽器のキー選択（C, Bb, F, Eb, A, D, G, Ab, Db, Gb, E, B）
  - 全12キー対応
- リアルタイム設定変更
  - 音を鳴らしたまま音律（平均律/純正律）を切替可能
  - 音を鳴らしたまま基準ピッチを変更可能
  - 音を鳴らしたままトランスポーズを変更可能

### 変更
- 設定変更時にアクティブな音の周波数を自動再計算

---

## [0.4.1] - 2026-01-27

### 追加
- コード名表示機能（C, Cm, C7, CM7 など自動判定）
- `chordUtils.ts` - コード判定ユーティリティ

### 変更
- グリッサンド動作改善 - 指を移動すると前の音を止めて新しい音だけ鳴る
- ホールドモード改善
  - 同じ鍵盤をもう一度押すとその音だけ解除
  - 全音停止ボタン削除（HOLD OFFで自動停止）
- HOLDボタンにヒントテキスト追加

---

## [0.4.0] - 2026-01-27

### 追加
- ハーモニーディレクター（Phase 4）
  - リアルなピアノ鍵盤UI（白鍵+黒鍵）
  - 2オクターブ表示
  - グリッサンド対応（スライドで連続発音）
  - 音域移動（C1〜C6）
  - 平均律/純正律切替
  - 基準ピッチ設定（A=430-450Hz）
  - 横画面（ランドスケープ）対応
  - `PianoKeyboard` コンポーネント
  - `HarmonyControls` コンポーネント
  - `useHarmonyStore` Zustandストア

### 変更
- expo-screen-orientation パッケージ追加
- ハーモニー画面を完全リニューアル

---

## [0.3.0] - 2026-01-27

### 追加
- 基本メトロノーム（Phase 3）
  - `useMetronome` フック - テンポ、拍子、再生/停止制御
  - `useMetronomeStore` Zustandストア - 状態管理
  - UIコンポーネント
    - `TempoControl` - テンポ表示・±1/±10調整
    - `BeatIndicator` - 拍インジケーター（アクセント対応）
    - `TimeSignatureSelector` - 拍子選択（8種類）
    - `PlayButton` - 再生/停止ボタン
    - `TapTempoButton` - タップテンポ機能
  - タップテンポ - 2-4回のタップで自動テンポ計算
  - 小節カウント表示

### 変更
- MetronomeScreen を全コンポーネント統合版に更新

---

## [0.2.0] - 2026-01-27

### 追加
- 音声エンジン（Phase 2）
  - `useAudioEngine` フック実装
  - Web Audio API によるトーン生成（Web環境）
  - OscillatorNode + GainNode によるサイン波生成
  - ADSR エンベロープ実装
  - メトロノームクリック音（アクセント: 1000Hz / 通常: 800Hz）
  - 持続音の開始/停止（ハーモニーディレクター用）
  - 高精度スケジューリング対応

### 変更
- `react-native-audio-api` → `expo-av` に変更（Expo Go互換性のため）
- メトロノーム画面に音声テストUIを追加
- ハーモニーディレクター画面にテスト用鍵盤を追加

### 注意
- ネイティブ環境（Expo Go）では視覚的フィードバックのみ
- 音声出力はWeb環境でのみ動作

---

## [0.1.0] - 2026-01-27

### 追加
- プロジェクト構成（Phase 1）
  - expo-router によるファイルベースルーティング
  - TypeScript 設定
  - Zustand 状態管理ストア（プレースホルダー）
  - 画面構成: ホーム、メトロノーム、ハーモニー、プログラム
  - スタイルシステム（colors, typography, spacing）
  - 型定義（types/index.ts）
  - ユーティリティ（pitchUtils, constants）

### 変更
- app.json: アプリ名を "Ensemble Support" に変更
- package.json: main を expo-router/entry に変更
- ダークテーマ（背景: #0D0D0D）をデフォルトに設定

---

## [0.0.1] - 2026-01-27

### 追加
- プロジェクト初期化（Expo blankテンプレート）
- 開発ドキュメント作成
  - 計画書 (ensemble_support_app.plan.md)
  - タスク管理票 (TASKS.md)
  - 技術仕様書 (TECH_SPEC.md)
  - 変更履歴 (CHANGELOG.md)

---

## バージョニング規則

このプロジェクトは [セマンティック バージョニング](https://semver.org/lang/ja/) に従います。

- **MAJOR**: 後方互換性のない変更
- **MINOR**: 後方互換性のある機能追加
- **PATCH**: 後方互換性のあるバグ修正

---

## 変更の種類

- **追加**: 新機能
- **変更**: 既存機能の変更
- **非推奨**: 将来削除予定の機能
- **削除**: 削除された機能
- **修正**: バグ修正
- **セキュリティ**: セキュリティに関する修正
